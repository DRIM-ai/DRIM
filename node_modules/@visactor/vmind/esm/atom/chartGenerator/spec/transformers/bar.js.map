{"version":3,"sources":["../src/atom/chartGenerator/spec/transformers/bar.ts"],"names":[],"mappings":"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","file":"bar.js","sourcesContent":["import { DataType } from '../../../../types/base';\nimport { getFieldByDataType } from '../../../../utils/field';\nimport type { GenerateChartCellContext } from '../../type';\nimport { COLOR_THEMES, DEFAULT_VIDEO_LENGTH } from '../constants';\nimport { axis, seriesField } from './cartesian';\nimport { data, discreteLegend, onlyUnique, revisedVChartType, theme } from './common';\n\nexport const colorBar = (context: GenerateChartCellContext) => {\n  const { colors, spec, chartTheme } = context;\n  // spec.data = [dataTable]\n  const colorThemes = COLOR_THEMES.default;\n  if (chartTheme) {\n    return { spec };\n  }\n  if (colors && colors.length > 0) {\n    spec.color = colors;\n  } else {\n    //apply transparent gradient\n    spec.color = colorThemes.map(c => ({\n      gradient: 'linear',\n      x0: 0.01,\n      y0: 0,\n      x1: 0.01,\n      y1: 1,\n      stops: [\n        {\n          offset: 0,\n          color: `#${c.split('#')[1]}FF`\n        },\n        {\n          offset: 1,\n          color: `#${c.split('#')[1]}00`\n        }\n      ]\n    }));\n  }\n\n  return { spec };\n};\n\nexport const cartesianBar = (context: GenerateChartCellContext) => {\n  //assign fields according to cell\n  const { cell, fieldInfo = [], spec, stackOrPercent } = context;\n  const cellNew = { ...cell };\n  const flattenedXField = Array.isArray(cell.x) ? cell.x : [cell.x];\n  if (cell.color && cell.color.length > 0 && cell.color !== cell.x) {\n    flattenedXField.push(cell.color as string);\n  }\n  spec.xField = flattenedXField;\n  spec.yField = cell.y;\n  if (cell.color) {\n    spec.seriesField = cell.color;\n  } else {\n    //没有分配颜色字段，从剩下的字段里选择一个离散字段分配到颜色上\n    const remainedFields = fieldInfo.filter(\n      ({ fieldName }) => !spec.xField.includes(fieldName) && spec.yField !== fieldName\n    );\n    const colorField = getFieldByDataType(remainedFields, [DataType.STRING, DataType.DATE]);\n    if (colorField) {\n      spec.seriesField = colorField.fieldName;\n      spec.xField.push(colorField.fieldName);\n      cellNew.color = colorField.fieldName;\n    }\n  }\n  if (spec.xField.length > 1 && stackOrPercent) {\n    spec.xField = [spec.xField[0]];\n    spec.stack = !!stackOrPercent;\n    spec.percent = stackOrPercent === 'percent';\n  }\n  return { spec, cell: cellNew };\n};\n\nexport const displayConfBar = (context: GenerateChartCellContext) => {\n  const { spec, chartTheme } = context;\n\n  if (chartTheme) {\n    return { spec };\n  }\n  spec.bar = {\n    style: {\n      //cornerRadius: [8, 8, 0, 0]\n    }\n  };\n\n  return { spec };\n};\n\nexport const transposeField = (context: GenerateChartCellContext) => {\n  const { spec, transpose } = context;\n  if (transpose) {\n    const newSpec = { ...spec, xField: spec.yField, yField: spec.xField, direction: 'horizontal' };\n    const bottomAxis = (newSpec.axes || []).find((axis: any) => axis.orient === 'bottom');\n    const leftAxis = (newSpec.axes || []).find((axis: any) => axis.orient === 'left');\n    if (bottomAxis) {\n      bottomAxis.orient = 'left';\n    }\n    if (leftAxis) {\n      leftAxis.orient = 'bottom';\n    }\n    return {\n      ...context,\n      spec: newSpec\n    };\n  }\n  return context;\n};\n\nexport const animationCartesianBar = (context: GenerateChartCellContext) => {\n  const { spec } = context;\n\n  const totalTime = context.totalTime ?? DEFAULT_VIDEO_LENGTH;\n  const groupKey = Array.isArray(spec.xField) ? spec.xField[0] : spec.xField;\n  const dataValues = spec.data.values as any[];\n  const groupNum = dataValues.map(d => d[groupKey]).filter(onlyUnique).length;\n  //const delay = totalTime / groupNum - 1000;\n  spec.animationAppear = {\n    oneByOne: Number.MIN_VALUE,\n    duration: totalTime / groupNum\n  };\n  return { spec };\n};\n\nexport const pipelineBar = [\n  data,\n  colorBar,\n  cartesianBar,\n  seriesField,\n  axis,\n  discreteLegend,\n  // commonLabel,\n  displayConfBar,\n  transposeField\n  //animationCartesianBar,\n];\n"]}