{"version":3,"sources":["../src/atom/dataExtraction/prompt/doubaoPrompt.ts"],"names":[],"mappings":";;;AAAA,2CAAuE;AAGvE,MAAM,oBAAoB,GAAG;;;;;;;;;;;OAWtB,CAAC;AAER,MAAM,YAAY,GAAG;;;;;;;;;;;;;;;;;;;;;CAqBpB,CAAC;AAEF,MAAM,mBAAmB,GAAG,CAAC,QAA+B,EAAE,EAAE,CAC9D;EAEA,QAAQ,KAAK,SAAS;IACpB,CAAC,CAAC,SAAS,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;0BACb;IACtB,CAAC,CAAC,mBAAmB,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,EACjD;CACC,CAAC;AAEF,MAAM,WAAW,GAAG,CAAC,WAAoB,EAAE,EAAE,CAAC;;;;;;;;;;;;EAY5C,WAAW,CAAC,CAAC,CAAC,2CAA2C,CAAC,CAAC,CAAC,EAAE;;;CAG/D,CAAC;AACF,MAAM,uBAAuB,GAAG,CAAC,QAA+B,EAAE,EAAE;IAClE,OAAO;;;sQAIL,QAAQ,KAAK,SAAS,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,eAC1C;gGAC8F,CAAC;AACjG,CAAC,CAAC;AACK,MAAM,aAAa,GAAG,CAC3B,QAA+B,EAC/B,cAAuB,KAAK,EAC5B,EAAE,CAAC;;EAEH,WAAW,CAAC,WAAW,CAAC;EACxB,uBAAuB,CAAC,QAAQ,CAAC;EACjC,oBAAoB;EACpB,mBAAmB,CAAC,QAAQ,CAAC;;2BAEJ,QAAQ;;;;;;;8HAQjC,QAAQ,KAAK,SAAS,CAAC,CAAC,CAAC,sBAAsB,CAAC,CAAC,CAAC,gCACpD;;;2BAG2B,QAAQ;;;;;;;;;;;;EAYjC,YAAY,EAAE,CAAC;AAlCJ,QAAA,aAAa,iBAkCT;AA0FV,MAAM,kBAAkB,GAAG,CAChC,QAA+B,EAC/B,cAAuB,KAAK,EAC5B,sBAA+B,KAAK,EACpC,EAAE,CAAC,IAAA,8BAAkB,EAAC,QAAQ,EAAE,WAAW,EAAE,mBAAmB,CAAC,CAAC;AAJvD,QAAA,kBAAkB,sBAIqC","file":"doubaoPrompt.js","sourcesContent":["import { getFieldInfoPrompt as gptFieldInfoPrompt } from './gptPrompt';\n\n/* eslint-disable max-len */\nconst dataTableExplanation = `## Data Table\n1. Key of dataTable is fieldName in fieldInfo\n1. The value type of a 'numerical', 'ratio', or 'count' field MUST be 'number' or 'number[]', and DO NOT perform any arithmetic operations..\n2. ALWAYS generate flatten data table rather than unflatten data table\n### Flatten Data Table Example\n\\`\\`\\`\ndataTable:[{date:\"Monday\",class:\"class No.1\",score:20},{date:\"Monday\",class:\"class No.2\",score:30},{date:\"Tuesday\",class:\"class No.1\",score:25},{date:\"Tuesday\",class:\"class No.2\",score:28}]\n\\`\\`\\`\n### Unflatten Data Table Example\n\\`\\`\\`\ndataTable:[{date:\"Monday\",classNo.1:20,classNo.2:30},{date:\"Tuesday\",classNo.1:25,classNo.2:28}]\n\\`\\`\\``;\n\nconst baseExamples = `# Examples1\ntext:今年6月各大厂商发布了过去1个月的财报数据，其中阿里在V月份利润额达到了1000亿，经调整后的利润额为100亿，而字节跳动V月份的利润额为800亿，经调整后利润额为120亿。\n\nResponse:\n\\`\\`\\`\n{\"fieldInfo\":[{\"fieldName\":\"公司\",\"description\":\"公司名称\",\"type\":\"string\",},{\"fieldName\":\"月份\",\"description\":\"具体月份\",\"type\":\"string\",},{\"fieldName\":\"利润调整\",\"description\":\"是否经过利润调整\",\"type\":\"string\",},{\"fieldName\":\"利润额\",\"description\":\"利润总额\",\"type\":\"numerical\",}],\"dataTable\":[{\"公司\":\"阿里\",\"月份\":\"5月\",\"利润调整\":\"调整前\",\"利润额\":100000000000,},{\"公司\":\"阿里\",\"月份\":\"5月\",\"利润调整\":\"调整后\",\"利润额\":10000000000,},{\"公司\":\"字节跳动\",\"月份\":\"5月\",\"利润调整\":\"调整前\",\"利润额\":80000000000,},{\"公司\":\"字节跳动\",\"月份\":\"5月\",\"利润调整\":\"调整后\",\"利润额\":12000000000,},]}\n\\`\\`\\`\n# Examples2\ntext: John Smith was very tall, ranking in the 90th percentile for his age group. He knew Jane Doe. who ranking in the 75th percentile for her age group.\n\nResponse:\n\\`\\`\\`\n{\"fieldInfo\":[{\"fieldName\":\"name\",\"description\":\"The name of a person\",\"type\":\"string\",},{\"fieldName\":\"ranking\",\"description\":\"The ranking of height in age group\",\"type\":\"ratio\"}],\"dataTable\":[{\"name\":\"John Smith\",\"ranking\":90,},{\"name\":\"Jane Doe\",\"ranking\":75}]}\n\\`\\`\\`\n# Examples3\ntext: 现在有大约60%-70%的年轻人有入睡困难，而在两年前，入睡困难的年轻人占比才只有30%。\n\nResponse:\n\\`\\`\\`\n{\"fieldInfo\":[{\"fieldName\":\"年份\",\"description\":\"数据对应时间\",\"type\":\"date\",dateGranularity:\"year\"},{\"fieldName\":\"入睡困难占比\",\"description\":\"年轻人入睡困呐占总人数的比例\",\"type\":\"ratio\"}],\"dataTable\":[{\"年份\":\"2024\",\"占比\":[0.6,0.7],},{\"年份\":\"2022\",\"占比\":0.3}]}\n\\`\\`\\`\n`;\n\nconst getCommonInfomation = (language: 'chinese' | 'english') =>\n  `# Common Information\n${\n  language === 'chinese'\n    ? `1. 今年是${new Date().getFullYear()}年\n2. 8.5折和85折含义相同，都代表85%的折扣`\n    : `1. This year is ${new Date().getFullYear()}`\n}\n`;\n\nconst getResponse = (showThoughs: boolean) => `\nResponse in the following format:\n\\`\\`\\`\n{\nfieldInfo: {\nfieldName: string;\ndescription: string;\ntype: 'date' | 'time' | 'string' | 'region' | 'numerical' | 'ratio' ｜ 'count';\nratioGranularity?: '%' | '‰'; // generate when fieldType is 'ratio', represent the ratio granularity of ratio data\ndateGranularity?: 'year' | 'quarter' | 'month' | 'week' | 'day'; // generate when fieldType is 'date', represent the date granularity of date time\n}[],\ndataTable: Record<string,string|number|number[]>[];\n${showThoughs ? 'thoughts: string, // your thought process' : ''}\n}\n\\`\\`\\`\n`;\nconst getFieldTypeExplanation = (language: 'chinese' | 'english') => {\n  return `## Field Information\n1. ALWAYS generate a field information, which represents the specific information of each column field in the data table.\n2. ALWAYS generate a field description\n3. ALWAYS generate a field type, chosen from 'date' | 'time' | 'string' | 'region' | 'numerical' | 'ratio' ｜ 'count';'date' refers to data that can be specified down to the year, quarter, month, week, or day.'ratio' means ratio value or percentage(%), such as ${\n    language === 'english' ? 'YoY or MoM' : '同比、环比、增长率、占比等'\n  }.The forms of ratio data are usually Percentage (%) such as 60%.'count' means count data\n4. ALWAYS generate dateGranularity for 'date' type, represent the date granularity of date time`;\n};\nexport const getBasePrompt = (\n  language: 'chinese' | 'english',\n  showThoughs: boolean = false\n) => `You are an expert extraction algorithm.You are an expert extraction algorithm, especially sensitive to data, date, category, data comparison and similar content.Your task is to extract high-quality data tables and field information from the text for further analysis, such as visualization charts, etc.\n# Response\n${getResponse(showThoughs)}\n${getFieldTypeExplanation(language)}\n${dataTableExplanation}\n${getCommonInfomation(language)}\n# Constraints:\n1. Answer language MUST: ${language}\n2. Strictly define the type of return format, use JSON format to reply, do not include any extra content.\n3. The extracted data strives for simplicity.\n4. Prefer flatten data table rather than unflatten data table.\n5. Numerical and Ratio data are unit-free, e.g., '10万' becomes '100000', '1k' becomes '1000'.\n6. Only extract value in ratio type, eg., '95%' becomes '95'; 'reduce 30%' becomes '-30'.\n7. Ensure the correctness of the value and type of each row in dataTable, return null for the value of unknown fields.\n8. The change in values should be reflected in the positive or negative nature of the data, not in the field names, such as ${\n  language === 'chinese' ? `'下降了50个点'的提取结果为'-50'` : `'Decrease by 50' becomes '-50'`\n}.\n# Steps\nYou should think step-by-step as follow:\n0. Answer language MUST: ${language}\n1. Check if the task involves data extraction. If not, set isDataExtraction to false in json mode; otherwise, proceed with steps.\n2. Read the entire text and generate the MOST IMPORTANT fields with numerical or ratio or count field type first.\n3. Re-read the text, generate concise and clear fields associated with the fields found in Step2.\n4. Extract all relevant data tables from the text based on field information. Each field's data should be concise and convey a single meaning.\n5. Format date data based on granularity, e.g., yyyy-mm-dd, mm-dd, mm, yyyy-mm, or yyyy-qq.\n6. When a date field has multiple date granularities, change the type of field to string.\n7. Extract interval/range data in the form of an array.\n8. Avoid any calculations or numerical conversions, like currency conversion.\n9. Check the data in the dataTable to ensure the correctness of the type.\n10. Recheck all data to ensure that no numerical or ratio data is missing.\n---\n${baseExamples}`;\n\n// export const getBasePrompt = (\n//   language: 'chinese' | 'english',\n//   showThoughs: boolean = false\n// ) => `You are an expert extraction algorithm.You are an expert extraction algorithm, especially sensitive to data, date, category, data comparison and similar content.Your task is to extract high-quality data tables and field information from the text for further analysis, such as visualization charts, etc.\n// # Response\n\n// Response in the following format:\n// \\`\\`\\`\n// {\n// fieldInfo: {\n// fieldName: string;\n// type: 'measure' | 'dimension';\n// isRatio?: boolean; // means ratio value or percentage(%), such as 同比、环比、增长率、占比等.The forms of ratio data are usually Percentage (%) such as 60%.\n// ratioGranularity?: '%' | '‰'; // generate when fieldType is 'ratio', represent the ratio granularity of ratio data\n// isDate?: boolean; //'date' refers to data that can be specified down to the year, quarter, month, week, or day.\n// dateGranularity?: 'year' | 'quarter' | 'month' | 'week' | 'day'; // generate when fieldType is 'date', represent the date granularity of date time\n// }[],\n// dataTable: Record<string,string|number|number[]>[];\n\n// }\n// \\`\\`\\`\n\n// ## Field Information\n// 1. ALWAYS generate a field information, which represents the specific information of each column field in the data table.\n// 2. ALWAYS generate dateGranularity when 'isDate' is true\n// 3. ALWAYS generate ratioGranularity when 'isRatio' is true.\n// ## Data Table\n// 1. Key of dataTable is fieldName in fieldInfo\n// 1. The value type of measure field MUST be 'number' or 'number[]', and DO NOT perform any arithmetic operations..\n// 2. ALWAYS generate flatten data table rather than unflatten data table\n// ### Flatten Data Table Example\n// \\`\\`\\`\n// dataTable:[{date:\"Monday\",class:\"class No.1\",score:20},{date:\"Monday\",class:\"class No.2\",score:30},{date:\"Tuesday\",class:\"class No.1\",score:25},{date:\"Tuesday\",class:\"class No.2\",score:28}]\n// \\`\\`\\`\n// ### Unflatten Data Table Example\n// \\`\\`\\`\n// dataTable:[{date:\"Monday\",classNo.1:20,classNo.2:30},{date:\"Tuesday\",classNo.1:25,classNo.2:28}]\n// \\`\\`\\`\n// # Common Information\n// 1. 今年是2024年\n// 2. 8.5折和85折含义相同，都代表85%的折扣\n\n// # Constraints:\n// 1. Answer language MUST: chinese\n// 2. Strictly define the type of return format, use JSON format to reply, do not include any extra content.\n// 3. The extracted data strives for simplicity.\n// 4. Prefer flatten data table rather than unflatten data table.\n// 5. Numerical and Ratio data are unit-free, e.g., '10万' becomes '100000', '1k' becomes '1000'.\n// 6. Only extract value in ratio type, eg., '95%' becomes '95'; 'reduce 30%' becomes '-30'.\n// 7. Ensure the correctness of the value and type of each row in dataTable, return null for the value of unknown fields.\n// 8. The change in values should be reflected in the positive or negative nature of the data, not in the field names, such as '下降了50个点'的提取结果为'-50'.\n// 9. The text may contain the contents of multiple data tables, and unrelated data can be set to null to distinguish them.\n// # Steps\n// You should think step-by-step as follow:\n// 0. Answer language MUST: chinese\n// 1. Check if the task involves data extraction. If not, set isDataExtraction to false in json mode; otherwise, proceed with steps.\n// 2. Read the entire text and generate the MOST IMPORTANT fields with numerical or ratio or count field type first.\n// 3. Re-read the text, generate concise and clear fields associated with the fields found in Step2.\n// 4. Extract data tables from the text based on field information directly. Each field's data should be concise and convey a single meaning.\n// 5. Extract interval/range data in the form of an array.\n// 6. Format date data based on granularity, e.g., yyyy-mm-dd, mm-dd, mm, yyyy-mm, or yyyy-qq.\n// 7. When a date field has multiple date granularities, change the type of field to string.\n// 8. Check the data in the dataTable to ensure the correctness of the type.\n// 9. Recheck all data to ensure that no measure data is missing.\n// ---\n// # Examples1\n// text:今年6月各大厂商发布了过去1个月的财报数据，其中阿里在V月份利润额达到了1000亿，经调整后的利润额为100亿，而字节跳动V月份的利润额为800亿，经调整后利润额为120亿。\n\n// Response:\n// \\`\\`\\`\n// {\"fieldInfo\":[{\"fieldName\":\"公司\",\"type\":\"dimension\",},{\"fieldName\":\"月份\",\"type\":\"dimension\",\"isDate\":true, \"dateGranularity\": \"month\"},{\"fieldName\":\"利润调整\",\"type\":\"dimension\",},{\"fieldName\":\"利润额\",\"type\":\"measure\",}],\"dataTable\":[{\"公司\":\"阿里\",\"月份\":\"5月\",\"利润调整\":\"调整前\",\"利润额\":100000000000,},{\"公司\":\"阿里\",\"月份\":\"5月\",\"利润调整\":\"调整后\",\"利润额\":10000000000,},{\"公司\":\"字节跳动\",\"月份\":\"5月\",\"利润调整\":\"调整前\",\"利润额\":80000000000,},{\"公司\":\"字节跳动\",\"月份\":\"5月\",\"利润调整\":\"调整后\",\"利润额\":12000000000,},]}\n// \\`\\`\\`\n// # Examples2\n// text: John Smith was very tall, ranking in the 90th percentile for his age group. He knew Jane Doe. who ranking in the 75th percentile for her age group.\n\n// Response:\n// \\`\\`\\`\n// {\"fieldInfo\":[{\"fieldName\":\"name\",\"type\":\"dimension\",},{\"fieldName\":\"ranking\",\"type\":\"measure\", \"isRatio\": true, \"ratioGranularity\": \"%\"}],\"dataTable\":[{\"name\":\"John Smith\",\"ranking\":90,},{\"name\":\"Jane Doe\",\"ranking\":75}]}\n// \\`\\`\\`\n// # Examples3\n// text: 现在有大约60%-70%的年轻人有入睡困难，而在两年前，入睡困难的年轻人占比才只有30%。\n\n// Response:\n// \\`\\`\\`\n// {\"fieldInfo\":[{\"fieldName\":\"年份\",\"type\":\"dimension\",dateGranularity:\"year\"},{\"fieldName\":\"入睡困难占比\",\"type\":\"measure\", \"isRatio\": true,}],\"dataTable\":[{\"年份\":\"2024\",\"占比\":[0.6,0.7],},{\"年份\":\"2022\",\"占比\":0.3}]}\n// \\`\\`\\`\n// `;\n\nexport const getFieldInfoPrompt = (\n  language: 'chinese' | 'english',\n  showThoughs: boolean = false,\n  reGenerateFieldInfo: boolean = false\n) => gptFieldInfoPrompt(language, showThoughs, reGenerateFieldInfo);\n"]}